FROM node:16.13.1

WORKDIR /app

COPY . .

ARG GHP_ACCESS_TOKEN
ENV GHP_ACCESS_TOKEN=${GHP_ACCESS_TOKEN}
ENV REACT_APP_GRAPHQL_URI=$REACT_APP_GRAPHQL_URI
ENV REACT_APP_SSO_HOST=$REACT_APP_SSO_HOST
ENV REACT_APP_REDIRECT_ON_SIGNOUT_URL=$REACT_APP_REDIRECT_ON_SIGNOUT_URL
ENV REACT_APP_INCLUDE_LOCAL_SCHEMA=$REACT_APP_INCLUDE_LOCAL_SCHEMA
ENV REACT_APP_RAISE_APP_URL=$REACT_APP_RAISE_APP_URL
ENV REACT_APP_APP_PERMISSION_JAILBREAK=$REACT_APP_APP_PERMISSION_JAILBREAK
ENV REACT_APP_SPLITIO_CLIENT_KEY=$REACT_APP_SPLITIO_CLIENT_KEY

RUN echo â€œ//npm.pkg.github.com/:_authToken=${GHP_ACCESS_TOKEN}â€ >> .npmrc

RUN yarn run build

RUN npm rebuild esbuild

RUN npm run build
